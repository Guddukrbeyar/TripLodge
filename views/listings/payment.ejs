<% layout("/layouts/boilerplate") %>

<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card shadow-lg border-0 rounded-4 p-4">

        <h3 class="text-center mb-4">üè† Wanderlust Payment</h3>

        <!-- Listing Details -->
        <div class="mb-3">
          <p><strong>Property:</strong> <%= listing.title %></p>
          <p><strong>Location:</strong> <%= listing.location %>, <%= listing.country %></p>
          <p><strong>Price:</strong> ‚Çπ <%= listing.price.toLocaleString("en-IN") %></p>
        </div>

        <!-- Image -->
        <div class="mb-4 text-center">
          <img src="<%= listing.image?.url || '/images/default.jpg' %>"
               alt="Listing Image"
               style="width:100%; border-radius:15px; max-height:300px; object-fit:cover;">
        </div>

        <!-- ‚úÖ Email Input -->
        <div class="mb-3">
          <label for="userEmailInput" class="form-label">Enter your email:</label>
          <input 
            type="email" 
            id="userEmailInput" 
            class="form-control"
            placeholder="example@gmail.com"
            required
          />
        </div>

        <!-- Pay Button -->
        <div class="text-center">
          <button class="btn btn-danger px-5 py-2" onclick="startPayment()">
            Pay Now ‚Çπ<%= listing.price.toLocaleString("en-IN") %>
          </button>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  function startPayment() {
    const email = document.getElementById("userEmailInput").value;

    if (!email || !email.includes("@")) {
      alert("Please enter a valid email!");
      return;
    }

    const amount = <%= listing.price %>;
    const listingId = "<%= listing._id %>";
    const title = "<%= listing.title.replace(/"/g, '\\"') %>";
    const location = "<%= listing.location %>, <%= listing.country %>";

    // ‚úÖ Correct order
    payFees(amount, listingId, title, location, email);
  }
</script>

<!-- Razorpay + Payment Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="/js/payment.js"></script>
